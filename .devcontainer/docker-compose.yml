# Copyright (c) 2024 Sundsvalls Kommun
#
# Licensed under the MIT License.

version: "3.8"
services:
  eneo:
    image: mcr.microsoft.com/devcontainers/python:3.11-bookworm
    command: sleep infinity
    networks:
      - eneo
    ports:
      - "8123:8123"
    environment:
      - POSTGRES_HOST=db
      - REDIS_HOST=redis
    volumes:
      - ../:/workspace
      # Mount Docker socket for testcontainers support
      - /var/run/docker.sock:/var/run/docker.sock
    # Docker group is created dynamically in post-create.sh with the correct GID
    # This ensures it works on any system regardless of the host's docker GID

  db:
    image: pgvector/pgvector:pg13
    networks:
      - eneo
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      POSTGRES_PASSWORD: postgres

  redis:
    image: redis
    networks:
      - eneo
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:

networks:
  eneo:
    name: eneo
