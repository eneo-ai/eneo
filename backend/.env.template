# =============================================================================
# LLM Provider API Keys (Global/Fallback)
# =============================================================================
# These are FALLBACK keys used when tenants don't have their own configured keys.
# Tenants can override these with tenant-specific keys via the sysadmin API:
#   PUT /api/v1/sysadmin/tenants/{tenant_id}/credentials/{provider}
#
# Multi-tenant behavior:
# - If tenant has a configured key → tenant key is used
# - If tenant has NO configured key → global key is used (fallback)
# - If tenant key is INVALID → strict error (NO fallback to global)

# =============================================================================
# Tenant Credential Management (Multi-Tenant Feature)
# =============================================================================
# Enable tenant-specific API credentials for LLM providers.
# When enabled, municipalities can configure their own API keys per tenant.
#
# TENANT_CREDENTIALS_ENABLED=false (default - single-tenant mode)
#   → Feature disabled, only global keys above are used
#   → No encryption key needed
#
# TENANT_CREDENTIALS_ENABLED=true (multi-tenant mode)
#   → Feature enabled, ENCRYPTION_KEY is REQUIRED
#   → Application fails on startup if ENCRYPTION_KEY missing
#   → All tenant credentials encrypted at rest (AES-128-CBC)
#
# Generate encryption key:
#   poetry run python -m intric.cli.generate_encryption_key

# [OPTIONAL] Enable tenant-specific LLM credentials (default: false)
TENANT_CREDENTIALS_ENABLED=false

# [CONDITIONAL] Encryption key for tenant credentials (REQUIRED if TENANT_CREDENTIALS_ENABLED=true)
# Generate with: poetry run python -m intric.cli.generate_encryption_key
# Format: 44-character base64-encoded Fernet key
# Example: FNVdDyfq0lBPAvjz_WS-9PB2UQzkbqCnwuA4KU9UbPU=
# WARNING: Backup this key securely - cannot decrypt credentials without it
ENCRYPTION_KEY=

# =============================================================================
# Federation Per Tenant (Multi-Tenant Authentication Feature)
# =============================================================================
# Enable tenant-specific identity providers (any OIDC-compliant IdP).
# When enabled, municipalities can configure their own IdP per tenant.
#
# FEDERATION_PER_TENANT_ENABLED=false (default - single-tenant mode)
#   → Feature disabled, only global OIDC_* config below is used
#   → All tenants share the same global IdP
#
# FEDERATION_PER_TENANT_ENABLED=true (multi-tenant mode)
#   → Feature enabled, ENCRYPTION_KEY is REQUIRED
#   → Each tenant can configure their own IdP via sysadmin API
#   → Tenant slugs must be configured for routing
#
# [OPTIONAL] Enable federation per tenant (default: false)
FEDERATION_PER_TENANT_ENABLED=false

# =============================================================================
# Generic OIDC Configuration (Global/Fallback)
# =============================================================================
# These OIDC_* variables replace legacy MOBILITYGUARD_* variables.
# Used as:
# - Global IdP when FEDERATION_PER_TENANT_ENABLED=false (single-tenant)
# - Fallback IdP when FEDERATION_PER_TENANT_ENABLED=true and tenant has no config
#
# [OPTIONAL] OIDC discovery endpoint URL
# Example: https://login.microsoftonline.com/{tenant-id}/v2.0/.well-known/openid-configuration
OIDC_DISCOVERY_ENDPOINT=

# [OPTIONAL] OIDC client ID
OIDC_CLIENT_ID=

# [OPTIONAL] OIDC client secret
OIDC_CLIENT_SECRET=

# [OPTIONAL] OIDC tenant ID (for backward compat with user creation)
OIDC_TENANT_ID=

# ==============================================================================
# PUBLIC ORIGIN (REQUIRED for OIDC in production)
# ==============================================================================
# The externally-reachable URL for this application.
# This is used to construct OIDC redirect_uri for authentication flows.
#
# IMPORTANT: This must be the URL that:
# 1. Users see in their browser address bar
# 2. Is registered in your OIDC provider (MobilityGuard, Azure AD, etc.)
# 3. Is externally accessible (for external users to complete OIDC callback)
#
# This may be:
# - A proxy/gateway URL: https://m00-https-eneo-test.login.sundsvall.se
# - A direct URL: https://eneo.sundsvall.se
# - Whatever URL is actually externally reachable in your network
#
# NOTE: Do NOT include path (e.g., /login/callback) - just the origin
#
# Examples:
#   Development:  PUBLIC_ORIGIN=https://localhost:3000
#   Test (proxy): PUBLIC_ORIGIN=https://m00-https-eneo-test.login.sundsvall.se
#   Production:   PUBLIC_ORIGIN=https://eneo.sundsvall.se
# ==============================================================================
PUBLIC_ORIGIN=

# [OPTIONAL] OpenAI API key for GPT models
# Get from: https://platform.openai.com/api-keys
# Example format: sk-proj-abc123...xyz789
OPENAI_API_KEY=

# [OPTIONAL] Anthropic API key for Claude models
# Get from: https://console.anthropic.com/
# Example format: sk-ant-api03-abc123...xyz789
ANTHROPIC_API_KEY=

# [OPTIONAL] Azure OpenAI API key (Global Fallback)
# Get from: Azure Portal -> Azure OpenAI Service -> Keys and Endpoint
# Azure requires ALL 4 fields below to be configured:
AZURE_API_KEY=
# [CONDITIONAL] Required if using Azure models (e.g., https://your-resource.openai.azure.com/)
AZURE_ENDPOINT=
# [CONDITIONAL] Same as AZURE_ENDPOINT, required for LiteLLM Azure models
AZURE_API_BASE=
# [CONDITIONAL] Required if using Azure models (e.g., gpt-4, gpt-35-turbo)
AZURE_MODEL_DEPLOYMENT=
# [CONDITIONAL] Required if using Azure models (e.g., 2024-02-15-preview)
AZURE_API_VERSION=

# [OPTIONAL] Mistral AI API key
# Get from: https://console.mistral.ai/
MISTRAL_API_KEY=

# [OPTIONAL] OVHCloud API key
OVHCLOUD_API_KEY=

# [OPTIONAL] Berget.ai API key for Swedish-hosted models
# Get from: https://berget.ai/
BERGET_API_KEY=
# [OPTIONAL] Berget.ai API base URL (default: https://api.berget.ai/v1)
BERGET_API_BASE=

# [OPTIONAL] Flux API key for image generation
FLUX_API_KEY=

# [OPTIONAL] Tavily API key for web search
TAVILY_API_KEY=

# [OPTIONAL] Self-hosted embedding service URL
INFINITY_URL=

# [OPTIONAL] vLLM self-hosted model service (Global/Fallback)
# URL to your vLLM server (e.g., http://localhost:8000 or http://vllm.internal:8000)
# Used by both legacy VLLM adapter and LiteLLM adapter (when tenant has no credential)
# For multi-tenant: Each tenant can configure their own VLLM endpoint via API
VLLM_MODEL_URL=
# [OPTIONAL] vLLM API key (authentication for self-hosted models)
# Used when tenant has no VLLM credential configured
VLLM_API_KEY=

# Marketplace and internal services
# [OPTIONAL] Internal marketplace API key
INTRIC_MARKETPLACE_API_KEY=
# [OPTIONAL] Internal marketplace URL
INTRIC_MARKETPLACE_URL=
# [OPTIONAL] Internal super API key
INTRIC_SUPER_API_KEY=
# [OPTIONAL] Internal super duper API key
INTRIC_SUPER_DUPER_API_KEY=

# Infrastructure dependencies
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_PORT=5432
POSTGRES_HOST=localhost
POSTGRES_DB=postgres
REDIS_HOST=localhost
REDIS_PORT=6379

# =============================================================================
# DEPRECATED: MobilityGuard (use OIDC_* instead - will be removed in v3.0)
# =============================================================================
# These variables are automatically migrated to OIDC_* on startup with warnings.
# Please update to OIDC_* variables above.
#
# [DEPRECATED] Use OIDC_DISCOVERY_ENDPOINT instead
MOBILITYGUARD_DISCOVERY_ENDPOINT=
# [DEPRECATED] Use OIDC_CLIENT_ID instead
MOBILITYGUARD_CLIENT_ID=
# [DEPRECATED] Use OIDC_CLIENT_SECRET instead
MOBILITYGUARD_CLIENT_SECRET=
# [DEPRECATED] Use OIDC_TENANT_ID instead
MOBILITYGUARD_TENANT_ID=

# Max sizes
UPLOAD_FILE_TO_SESSION_MAX_SIZE=10485760
UPLOAD_IMAGE_TO_SESSION_MAX_SIZE=10485760
UPLOAD_MAX_FILE_SIZE=10485760
TRANSCRIPTION_MAX_FILE_SIZE=10485760
MAX_IN_QUESTION=1

# Migration settings
# Auto-recalculate usage statistics threshold for model migrations
# If a migration affects <= this many entities, usage stats will be recalculated automatically
# If a migration affects > this many entities, manual recalculation is required via sysadmin endpoint
MIGRATION_AUTO_RECALC_THRESHOLD=30

# Feature flags
# [OPTIONAL] Enable access management features (default: True)
USING_ACCESS_MANAGEMENT=True
# [OPTIONAL] Enable Azure OpenAI models (default: False)
USING_AZURE_MODELS=False
# [OPTIONAL] Enable Identity and Access Management (default: False)
USING_IAM=False
# [OPTIONAL] Enable image generation features (default: False)
USING_IMAGE_GENERATION=False
# [OPTIONAL] Enable web crawling features (default: True)
USING_CRAWL=True
# [OPTIONAL] Enable testing mode (default: False)
TESTING=False
# [OPTIONAL] Enable development mode (default: False)
DEV=False

###############################################################################
# ENCRYPTION
###############################################################################
# [REQUIRED] Generic encryption key for sensitive data (HTTP Basic Auth, API keys, etc.)
# Uses Fernet symmetric encryption (AES 128 CBC + HMAC)
# Generate: python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'
# Default key below is for local dev only - MUST generate new key for production!
ENCRYPTION_KEY=QkSCr5VaR6dH8VXOCgp9TGh9JSV2qgkao9nxFmtxMfE=

###############################################################################
# WEB CRAWLING SETTINGS
###############################################################################

## Scrapy Crawler Settings
# [OPTIONAL] Maximum crawl duration in seconds (default: 14400 = 4 hours)
CRAWL_MAX_LENGTH=14400
# [OPTIONAL] Maximum items to crawl before stopping (default: 20000)
CLOSESPIDER_ITEMCOUNT=20000
# [OPTIONAL] Respect robots.txt files (default: True)
OBEY_ROBOTS=True
# [OPTIONAL] Enable automatic request throttling (default: True)
AUTOTHROTTLE_ENABLED=True

## Worker Configuration
# [OPTIONAL] Maximum concurrent jobs the worker can process at once (default: 20)
# Why: Controls overall system load - reduce if server has limited RAM
# Recommendation: Use 10-15 for servers with <8GB RAM, 20+ for larger servers
WORKER_MAX_CONCURRENT_JOBS=5

## Crawl Retry Configuration
# [OPTIONAL] Maximum retries for failed pages during crawl (default: 3)
# Why: Network hiccups or temporary errors shouldn't lose pages permanently
# Failed pages are retried with exponential backoff before being marked as failed
CRAWL_PAGE_MAX_RETRIES=3
# [OPTIONAL] Initial retry delay in seconds with exponential backoff (default: 1.0)
# Why: 1s, 2s, 4s delays give servers time to recover from transient errors
# Example: attempt 1 waits 1s, attempt 2 waits 2s, attempt 3 waits 4s
CRAWL_PAGE_RETRY_DELAY=1.0

# Integrations and callbacks
# [OPTIONAL] OAuth callback URL for integrations
OAUTH_CALLBACK_URL=
# [OPTIONAL] Confluence client ID for integration
CONFLUENCE_CLIENT_ID=
# [OPTIONAL] Confluence client secret for integration
CONFLUENCE_CLIENT_SECRET=
# [OPTIONAL] SharePoint client ID for integration
SHAREPOINT_CLIENT_ID=
# [OPTIONAL] SharePoint client secret for integration
SHAREPOINT_CLIENT_SECRET=


# ==============================================================================
# Security
# ==============================================================================
API_PREFIX=/api/v1
API_KEY_LENGTH=64
API_KEY_HEADER_NAME=example
JWT_AUDIENCE=*
JWT_ISSUER=EXAMPLE
JWT_EXPIRY_TIME=86000
JWT_ALGORITHM=HS256

# JWT_SECRET - CRITICAL FOR PRODUCTION
# Used for signing OIDC state tokens and user authentication tokens.
# WARNING: The default value below is weak and for development only!
# DO NOT use the default in production - weak secrets enable token forgery and session hijacking.
#
# Minimum strength: 32 characters (256+ bits)
# Generate a strong secret with:
#   python -c 'import secrets; print(secrets.token_hex(32))'
#
# For development convenience, a weak default is provided below.
# For staging/production, generate and set a strong secret.
JWT_SECRET=1234

JWT_TOKEN_PREFIX=
URL_SIGNING_KEY=

# Default tenant and user
DEFAULT_TENANT_NAME=ExampleTenant
DEFAULT_TENANT_QUOTA_LIMIT=10737418240
DEFAULT_USER_NAME=ExampleUser
DEFAULT_USER_EMAIL=user@example.com
DEFAULT_USER_PASSWORD=Password1!

# Log
# Set to INFO for clean logs with optional crawl monitor display
# Set to DEBUG for detailed debugging (note: debug logs may interfere with monitor display)
LOGLEVEL=DEBUG
